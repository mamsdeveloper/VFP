#:import platform sys.platform
#
# Screens
#
<AppScreenManager>:
    canvas.before:
        Rectangle:
            source: "background.png"
            pos: self.pos
            size: self.size


#@@@@@@@
<ScreenBox@MDGridLayout>:
    cols: 1
    padding: ["8sp", "15sp"]
    spacing: "15sp"
    

#@@@@@@@
<ParentScreen>:
    radius: [25, 0, 0, 0]
    md_bg_color: 0, 0, 0, 0

    
#
# Areas
#
<ParentArea>:
    cols: 1
    height: self.minimum_height
    size_hint_y: None
    padding: ["10sp", "15sp"]
    spacing: "12sp"


#@@@@@@@
<AreaScroll@ScrollView>:
    bar_width: 0
    canvas.before:
        Color:
            rgba: 1, 1, 1, .6
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.parent.height*.02]


#@@@@@@@
<MainArea>:
    size_hint: 1, 1
    # AAAAAAAAAAAAAAAAA Amazing feature
    ScatterLayout:
        Image:
            source: "logo.png"


#@@@@@@@
<SettingsArea>:
    SimpleLabel:
        text: "Название организации:"
        
    SimpleTextInput:
        hint_text: "Название организации"
        
    SimpleLabel:
        text: "Преподаватель:"

    MDGridLayout:
        cols: 1
        spacing: "12sp"
        adaptive_height: True
        canvas.before:
            Color:
                rgba: 0, 0, 0, .2
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [self.height*.2]
        
        SimpleTextInput:
            hint_text: "ФИО"

        SimpleTextInput:
            hint_text: "Звание"

        SimpleTextInput:
            hint_text: "Должность"
    
    SimpleLabel:
        text: "Курсы:"

    ExpsList:
        name: "classes_exps"

    AnchorLayout:
        anchor_x: "center"
        size_hint_y: None
        height: "40sp"

        SubButton:
            icon: "plus-circle"
            on_release: root.parent.parent.parent.children[0].children[1].children[0].children[4].add_exp(self)

    SimpleLabel:
        text: "Упражнения:"

    ExpsList:
        name: "exercises_exps"

    AnchorLayout:
        anchor_x: "center"
        size_hint_y: None
        height: "40sp"

        SubButton:
            icon: "plus-circle"
            on_release: root.parent.parent.parent.children[0].children[1].children[0].children[1].add_exp(self)


#@@@@@@@
<ClassArea>:
    SimpleLabel:
        text: root.parent.parent.parent.title
    
    StudentsList:
    
    AnchorLayout:
        anchor_x: "center"
        size_hint_y: None
        height: "40sp"

        SubButton:
            icon: "plus-circle"
            on_release: self.parent.parent.children[1].add_student()


#@@@@@@@
<ExerciseArea>:
    SimpleLabel:
        text: root.parent.parent.parent.title
    
    SimpleLabel:
        text: "«5»"

    SimpleTextInput:
        hint_text: "Отлично"
    
    SimpleLabel:
        text: "«4»"

    SimpleTextInput:
        hint_text: "Хорошо"

    SimpleLabel:
        text: "«3»"

    SimpleTextInput:
        hint_text: "Удоволетворительно"

# area with file settings as school name, teacher and other
<FileSettingsArea>:
    SimpleLabel:
        text: "Название организации:"
        
    SimpleTextInput:
        hint_text: "Название организации"

    SimpleLabel:
        text: "Преподаватель:"

    MDGridLayout:
        cols: 1
        spacing: "12sp"
        adaptive_height: True
        canvas.before:
            Color:
                rgba: 0, 0, 0, .2
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [self.height*.2]
        
        SimpleTextInput:
            hint_text: "ФИО"

        SimpleTextInput:
            hint_text: "Звание"

        SimpleTextInput:
            hint_text: "Должность"

    SimpleLabel:
        text: "Упражнения:"
    
    GridLayout:
        cols: 1
        size_hint_y: None
        height: self.minimum_height
        spacing: "10sp"
        padding: ["5sp", 0]

    SimpleLabel:
        text: "Класс:"

    DropInput:
    

#@@@@@@@
<FileWriteArea>:
    SimpleLabel:
        text: "Write class marks"
    
    SimpleLabel:
        text: str(root.parent.parent.parent.students) if root.parent else "Hello"


#@@@@@@@
<FileViewArea>:
#
# Area"s items
#
<SimpleLabel@MDLabel>:
    padding: ["5sp", 0]
    size_hint_y: None
    height: self.font_size
    font_size: "22sp"


#@@@@@@@
<TunedTextInput>:
    line_height: self.height
    multiline: False    
    pos: self.parent.pos
    padding: ["8sp", self.height//4-self.font_size//8]
    size_hint: 0.95, 1
    color: (0, 0, 0, 1)
    text_size: self.size
    font_size: "20sp"
    background_normal: ""
    background_active: ""
    background_color: (0, 0, 0, 0)
    cursor_color: (.4, .4, .4, 1)
    cursor_width: 2
    on_focus: self.adopt_scroll()
    on_text: self.parent.text = self.text


#@@@@@@@
<SimpleTextInput@FloatLayout>:
    size_hint_y: None
    height: "40sp"
    hint_text: ""
    text: ""

    canvas.before:
        Color: 
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.height*.2]
    
    TunedTextInput:
        hint_text: self.parent.hint_text
        text: root.text


#@@@@@@@
<StudentsList>:
    cols: 1
    height: 0
    adaptive_height: True
    spacing: "10sp"


#@@@@@@@
<StudentItem>:
    cols: 2
    size_hint_y: None
    height: "40sp"
    text: ""

    SimpleTextInput:
        hint_text: "ФИО"
        text: root.text

    SubButton:
        icon: "minus-circle"
        on_release: root.parent.del_student(root)


<SubButton@MDIconButton>:
    user_font_size: "24sp"
    theme_text_color: "Custom"
    text_color: (.4, .4, .4, 1)
    height: "40sp"
    width: "45sp"


#@@@@@@@
<ArrowButton@MDIconButton>:
    icon: "menu-right"
    theme_text_color: "Custom"
    text_color: (.4, .4, .4, 1)
    height: "40sp"


#@@@@@@@
<CB>:
    cols: 2
    text: ""
    standarts: []
    adaptive_height: True
    spacing: "10sp"

    MDCheckbox:
        size_hint: None, None
        size: "22sp", "22sp"
        pos_hint: {"center_x": .5, "center_y": .5}
        on_active: root.parent.parent.parent.parent.parent.update_exercises(root.parent)
    
    MDLabel:
        text: root.text
        font_size: "20sp"


#
# Custom Expansion Panel
#
<ExpsList>:
    cols: 1
    adaptive_height: True
    height: 0
    spacing: "10sp"


#@@@@@@@
<ExpPanel>:
    cols: 2
    adaptive_height: True


#@@@@@@@
<ExpPanelBox>:
    rad: 40
    cols: 1
    adaptive_height: True
    canvas.before:
        Color:
            rgba: 0, 0, 0, .2
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.rad]


#@@@@@@@
<ExpPanelItemsList>:
    cols: 1
    adaptive_height: True
    spacing: "10sp"
    padding: [0, "10sp", 0, 0] if self.height > 10 else [0, ]


#@@@@@@@
<ExpPanelAddButton>:
    anchor_x: "center"
    size_hint_y: None
    height: "40sp"

    SubButton:
        icon: "plus-circle"
        on_release: root.parent.children[1].add_item()
 

#@@@@@@@
<ExpRightButton>
    anchor_y: "top"
    size_hint_x: None
    width: self.children[0].width

    SubButton:
        icon: "minus-circle"
        height: "40sp"
        on_release: root.parent.parent.del_exp(self)


#@@@@@@@
<ExpPanelFirstItem>:
    placeholder: ""
    cols: 2
    size_hint_y: None
    height: "40sp"
    text: ""
    canvas.before:
        Color: 
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size 
            radius: [self.height*.2] 
    
    TunedTextInput:
        hint_text: root.placeholder
            
    ExpArrow:


#@@@@@@@
<ExpPanelItem>:
    cols: 2
    size_hint_y: None
    height: "40sp"
    students: []
    standarts: []

    ExpPanelInput:
        SubButton:
            icon: "pencil"
            height: "40sp"
            on_release: root.update(self.parent.children[1])
     
    SubButton:
        icon: "minus-circle"
        height: "40sp"
        on_release: root.parent.del_item(root)


#@@@@@@@
<ExpArrow@ArrowButton>:
    on_release: self.parent.parent.parent.change_state()


#@@@@@@@
<ExpPanelInput@GridLayout>:
    size_hint_y: None
    height: "40sp"
    cols: 2
    text: ""
    canvas.before:
        Color: 
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size 
            radius: [self.height*.2] 
    
    TunedTextInput:
        hint_text: "Класс"


#
# Custom Drop Menu
#
<DropInput>:
    cols: 1
    adaptive_height: True
    text: ""

  
#@@@@@@@
<DropInputFirstItem>:
    cols: 2
    size_hint_y: None
    height: "40sp"
    text: ""
    canvas.before:
        Color: 
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size 
            radius: [self.height*.2] 
    
    MDLabel:
        text: "Курс (класс)"
        theme_text_color: "Custom"
        text_color: (.4, .4, .4, 1) if self.text == "Курс (класс)" else (0, 0, 0, 1)
        padding: ["8sp", self.height//4-self.font_size//8]
        font_size: "20sp"
     
    DropArrow:


#@@@@@@@
<DropInputDropArea>:
    anchor_x: "right"
    size_hint_y: None
    height: "180sp"


#@@@@@@@ 
<DropInputScroll>:
    rad: 40
    cols: 1
    bar_width: "5sp"
    bar_color: (.4, .4, .4, 1)
    size_hint: None, None
    height: "180sp"
    width: self.parent.width*.5 if self.parent else 0
    effect_cls: "ScrollEffect"

    canvas.before:
        Color: 
            rgba: 0, 0, 0, .2
        RoundedRectangle:
            pos: self.pos
            size: self.size 
            radius: [0, self.rad, self.rad, self.rad]
    
    DropInputItemsList:
    

#@@@@@@@
<DropInputItemsList@GridLayout>:
    cols: 1
    height: self.minimum_height
    size_hint_y: None
    spacing: "10sp"
    padding: [0, "10sp", 0, 0] 


#@@@@@@@
<DropArrow@ArrowButton>:
    on_release: self.parent.parent.change_state()


#@@@@@@@
<DropListItem>:
    name: ""
    students: []
    group: ""
    size_hint_y: None
    height: "35sp"
    background_normal: ""
    background_color: (0, 0, 0, 0)
    canvas.before:
        Color: 
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.height*.2]
    
    MDLabel:
        size_hint: None, None
        size: root.size
        pos: root.pos
        padding: ["5sp", 0]
        font_size: "18sp"
        text: root.name

    
#
# Navs
# 
<Nav@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: .08
    canvas.before:
        Color: 
            rgba: 1, 1, 1, .6
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.parent.height*.02]


#@@@@@@@
<NavItem@MDIconButton>:
    pos_hint: {"center_x": .5, "center_y": .5}
    user_font_size: "32sp"


#@@@@@@@
<NavSub@FloatLayout>:
    name: ""
    canvas.before:
        Color: 
            rgba: (1, 1, 1, .6) if self.parent.parent.parent.area == self.name else (0, 0, 0, 0)

        Ellipse:
            pos: self.center_x-self.height*.7//2, self.center_y-self.height*.7//2
            size: self.height*.7, self.height*.7


#@@@@@@@
<NavSubEmpty@FloatLayout>:
#
# Main Screen
#
<MainScreen>:
    ScreenBox:
        AreaScroll:
            MainArea:

        Nav:
            FloatLayout:
                NavItem: 
                    name: "Create"
                    icon: "plus-circle"
                    on_release: root.redirect(self)

            FloatLayout:
                NavItem: 
                    name: "OpenFile"
                    icon: "folder-outline"
                    on_release: root.redirect(self)

            FloatLayout:
                NavItem:
                    name: "View" 
                    icon: "view-list"
                    on_release: root.redirect(self)

            FloatLayout:
                NavItem:
                    name: "Settings" 
                    # !!!WARNING!!!                    
                    icon: "settings" if platform == "linux" else "cog" # remove on prodaction
                    on_release: root.redirect(self)        


#
# Create Screen
#
<CreateScreen>:
    area: "SettingsScreen"

    ScreenBox:
        spacing: 0
        AreaScroll:  

        # Sub Nav
        BoxLayout:
            size_hint_y: None
            height: "15sp"
            NavSub:
                name: "SettingsArea"

            NavSub:
                name: "WriteArea"

            NavSubEmpty:

            NavSubEmpty:

        Nav:
            FloatLayout:
                NavItem: 
                    name: "SettingsArea"
                    icon: "wrench"
                    on_release: root.change_area(self)
                
            FloatLayout:
                NavItem:
                    name: "WriteArea"
                    icon: "view-list" 
                    on_release: root.change_area(self)

            FloatLayout:
                NavItem:
                    icon: "content-save" 
                    on_release: pass
        
            FloatLayout:
                NavItem:
                    name: "Main"
                    icon: "home" 
                    on_release: root.redirect(self)



#
# Settings Screen
#                   
<SettingsScreen>:
    ScreenBox:
        AreaScroll:
            SettingsArea:
                          
        Nav:
            FloatLayout:
                NavItem: 
                    name: "Main"
                    icon: "content-save"
                    on_release: root.save_settings(self)

            FloatLayout:
                NavItem:
                    name: "Main" 
                    icon: "home" 
                    on_release: root.redirect(self) 
#
# Class Screen
# 
<ClassScreen>:
    students: []
    title: ""
    ScreenBox:
        AreaScroll:
            ClassArea:
                
        Nav:
            FloatLayout:
                NavItem: 
                    name: "Settings"
                    icon: "arrow-left-circle"
                    on_release:
                        root.update_students() 
                        root.redirect(self)
                        root.parent.update_settings_students(root.name, root.students)
#
# Exercise Screen
#                
<ExerciseScreen>:
    standarts: []
    title: ""
    ScreenBox:
        AreaScroll:
            ExerciseArea:
                
        Nav:
            FloatLayout:
                NavItem: 
                    name: "Settings"
                    icon: "arrow-left-circle"
                    on_release:
                        root.update_standarts()
                        root.redirect(self)
                        root.parent.update_settings_standarts(root.title, root.standarts)
#
# OpenFileScreen
#
<OpenFileScreen>:
    ScreenBox:
        AreaScroll:
            
        Nav:
            FloatLayout:
                NavItem: 
                    name: "Create"
                    icon: "check-circle"
                    on_release: root.choose_file(self)

            FloatLayout:
                NavItem:
                    name: "Main" 
                    icon: "home" 
                    on_release: root.redirect(self)

